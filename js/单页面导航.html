<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>聊聊单页应用导航 | hecun&#39;s blog</title>
    <meta name="description" content="进击的程序源-hecun">
    <link rel="icon" type="image/x-icon" href="/img/logo.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/img/logo.ico">
  <link rel="stylesheet" type="text/css" href="/css/main.css">
  <mate name="keywords" content="进击的程序源,hecun,禾寸"></mate>
    
    <link rel="preload" href="/assets/css/0.styles.ccc4724e.css" as="style"><link rel="preload" href="/assets/js/app.c2692aa7.js" as="script"><link rel="preload" href="/assets/js/7.ee9b7330.js" as="script"><link rel="preload" href="/assets/js/2.55ffe7b1.js" as="script"><link rel="preload" href="/assets/js/58.4c8ae67e.js" as="script"><link rel="prefetch" href="/assets/js/1.6d24a22a.js"><link rel="prefetch" href="/assets/js/10.b80e02fd.js"><link rel="prefetch" href="/assets/js/11.22b74af9.js"><link rel="prefetch" href="/assets/js/12.474b79db.js"><link rel="prefetch" href="/assets/js/13.23a8ba9e.js"><link rel="prefetch" href="/assets/js/14.8437854b.js"><link rel="prefetch" href="/assets/js/15.eb2c7e6a.js"><link rel="prefetch" href="/assets/js/16.14cc9f96.js"><link rel="prefetch" href="/assets/js/17.178deaf5.js"><link rel="prefetch" href="/assets/js/18.b922d114.js"><link rel="prefetch" href="/assets/js/19.6967fed4.js"><link rel="prefetch" href="/assets/js/20.f9680dc5.js"><link rel="prefetch" href="/assets/js/21.c28a6930.js"><link rel="prefetch" href="/assets/js/22.973aab73.js"><link rel="prefetch" href="/assets/js/23.cb215d9f.js"><link rel="prefetch" href="/assets/js/24.b3c058a2.js"><link rel="prefetch" href="/assets/js/25.34e23410.js"><link rel="prefetch" href="/assets/js/26.ab9e6475.js"><link rel="prefetch" href="/assets/js/27.64be3436.js"><link rel="prefetch" href="/assets/js/28.d2524c5b.js"><link rel="prefetch" href="/assets/js/29.04fa85aa.js"><link rel="prefetch" href="/assets/js/3.53c1b047.js"><link rel="prefetch" href="/assets/js/30.5bccadb5.js"><link rel="prefetch" href="/assets/js/31.0a4f2335.js"><link rel="prefetch" href="/assets/js/32.4568bb0b.js"><link rel="prefetch" href="/assets/js/33.f1ee24e2.js"><link rel="prefetch" href="/assets/js/34.6ead242e.js"><link rel="prefetch" href="/assets/js/35.27efa193.js"><link rel="prefetch" href="/assets/js/36.362e5f5c.js"><link rel="prefetch" href="/assets/js/37.0e4794b1.js"><link rel="prefetch" href="/assets/js/38.9fc75844.js"><link rel="prefetch" href="/assets/js/39.894a1b86.js"><link rel="prefetch" href="/assets/js/40.e2708e69.js"><link rel="prefetch" href="/assets/js/41.a3603a43.js"><link rel="prefetch" href="/assets/js/42.cf7dc3ee.js"><link rel="prefetch" href="/assets/js/43.363d291a.js"><link rel="prefetch" href="/assets/js/44.8d29c24e.js"><link rel="prefetch" href="/assets/js/45.2db43ddc.js"><link rel="prefetch" href="/assets/js/46.0fba0e84.js"><link rel="prefetch" href="/assets/js/47.10f4922e.js"><link rel="prefetch" href="/assets/js/48.56fcc68c.js"><link rel="prefetch" href="/assets/js/49.11209a48.js"><link rel="prefetch" href="/assets/js/5.75ce7176.js"><link rel="prefetch" href="/assets/js/50.98492dc0.js"><link rel="prefetch" href="/assets/js/51.879e5063.js"><link rel="prefetch" href="/assets/js/52.69cb96eb.js"><link rel="prefetch" href="/assets/js/53.a0d23912.js"><link rel="prefetch" href="/assets/js/54.e84d6748.js"><link rel="prefetch" href="/assets/js/55.6a87de8d.js"><link rel="prefetch" href="/assets/js/56.0e16ce35.js"><link rel="prefetch" href="/assets/js/57.89321769.js"><link rel="prefetch" href="/assets/js/59.345b425f.js"><link rel="prefetch" href="/assets/js/6.f8e51914.js"><link rel="prefetch" href="/assets/js/60.350e74f0.js"><link rel="prefetch" href="/assets/js/61.740d651d.js"><link rel="prefetch" href="/assets/js/62.ba2263d7.js"><link rel="prefetch" href="/assets/js/63.b248662e.js"><link rel="prefetch" href="/assets/js/64.bf046848.js"><link rel="prefetch" href="/assets/js/65.dbff5786.js"><link rel="prefetch" href="/assets/js/66.bf57fc70.js"><link rel="prefetch" href="/assets/js/67.42d8239d.js"><link rel="prefetch" href="/assets/js/68.fc59e5ca.js"><link rel="prefetch" href="/assets/js/69.08badfb0.js"><link rel="prefetch" href="/assets/js/70.5e3539ab.js"><link rel="prefetch" href="/assets/js/71.fc913d54.js"><link rel="prefetch" href="/assets/js/72.9406c0cf.js"><link rel="prefetch" href="/assets/js/73.b3485dd2.js"><link rel="prefetch" href="/assets/js/74.f699d6d0.js"><link rel="prefetch" href="/assets/js/75.3b6cf9de.js"><link rel="prefetch" href="/assets/js/76.dae9c229.js"><link rel="prefetch" href="/assets/js/77.a8ab0c06.js"><link rel="prefetch" href="/assets/js/78.6d217328.js"><link rel="prefetch" href="/assets/js/79.4d5870b3.js"><link rel="prefetch" href="/assets/js/8.096c476a.js"><link rel="prefetch" href="/assets/js/80.9fd35370.js"><link rel="prefetch" href="/assets/js/81.ac815421.js"><link rel="prefetch" href="/assets/js/82.918ca1dd.js"><link rel="prefetch" href="/assets/js/83.a6957825.js"><link rel="prefetch" href="/assets/js/84.34be1d45.js"><link rel="prefetch" href="/assets/js/85.f591015b.js"><link rel="prefetch" href="/assets/js/86.4b4fbaad.js"><link rel="prefetch" href="/assets/js/87.24552fe7.js"><link rel="prefetch" href="/assets/js/88.1fe39b72.js"><link rel="prefetch" href="/assets/js/89.b6257e02.js"><link rel="prefetch" href="/assets/js/9.89b67f33.js"><link rel="prefetch" href="/assets/js/90.14b158b9.js"><link rel="prefetch" href="/assets/js/91.00cf1ef4.js"><link rel="prefetch" href="/assets/js/92.44b6910d.js"><link rel="prefetch" href="/assets/js/93.2b920839.js"><link rel="prefetch" href="/assets/js/94.e03699fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccc4724e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">hecun's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/vue/" class="nav-link">VUE</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/think/" class="nav-link">随想</a></div><div class="nav-item"><a href="https://github.com/hecun0000" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/vue/" class="nav-link">VUE</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/think/" class="nav-link">随想</a></div><div class="nav-item"><a href="https://github.com/hecun0000" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>聊聊单页应用导航</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#写在前面" class="sidebar-link">写在前面</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#web应用中的导航" class="sidebar-link">web应用中的导航</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#传统导航" class="sidebar-link">传统导航</a></li><li class="sidebar-sub-header"><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#单页应用导航" class="sidebar-link">单页应用导航</a></li></ul></li><li><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#路由的工作机制" class="sidebar-link">路由的工作机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#片段标识符" class="sidebar-link">片段标识符</a></li><li class="sidebar-sub-header"><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#html5-history" class="sidebar-link">html5 history</a></li></ul></li><li><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#实现一个简版的vue-router" class="sidebar-link">实现一个简版的vue-router</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#先看看怎么使用-vue-router" class="sidebar-link">先看看怎么使用  vue-router</a></li><li class="sidebar-sub-header"><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#主要思路" class="sidebar-link">主要思路</a></li><li class="sidebar-sub-header"><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#最后成果" class="sidebar-link">最后成果</a></li></ul></li><li><a href="/js/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA.html#写在最后" class="sidebar-link">写在最后</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="聊聊单页应用导航"><a href="#聊聊单页应用导航" class="header-anchor">#</a> 聊聊单页应用导航</h1> <p><img src="https://img.hecun.site/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA-eb4f-icqznha3164770-2019825121044.jpg" alt="单页面导航-eb4f-icqznha3164770-2019825121044"></p> <h2 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h2> <p>近几年单页应用（SPA）越来越来火，也成为了主流，其中Vue，React，Angular就是典型的代表。将导航的实现放在了客户端去处理，极大提升了用户体验，给人一直类似原生应用的效果。下面我们就简单了解下。</p> <h2 id="web应用中的导航"><a href="#web应用中的导航" class="header-anchor">#</a> web应用中的导航</h2> <h3 id="传统导航"><a href="#传统导航" class="header-anchor">#</a> 传统导航</h3> <p>在传统Web应用中，导航是一个页面为单位进行。在地址栏输入路径，页面请求会发往服务器，服务器响应并返回一个完整的HTML页面。浏览器收到HTML页面进行渲染。要显示新的内容，浏览器往往要执行一次完整的刷新动作。</p> <p><img src="https://img.hecun.site/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA-%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8%E5%AF%BC%E8%88%AA-%E4%BC%A0%E7%BB%9F%E6%A8%A1%E5%BC%8F-2019825111934.png" alt="单页面导航-单页应用导航-传统模式-2019825111934"></p> <h3 id="单页应用导航"><a href="#单页应用导航" class="header-anchor">#</a> 单页应用导航</h3> <p>在单页应用中通常就一个index.html文件。在用户切换导航的时候视图无缝呈现。更像是原生应用。一旦页面加载完成，后续的操作都不需要刷新页面。</p> <p><img src="https://img.hecun.site/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA-%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8%E5%AF%BC%E8%88%AA-SPA-2019824215616.png" alt="单页面导航-单页面应用导航-SPA-2019824215616"></p> <p>在单页应用中，路由承载了管理应用的程序状态，业务以及数据的状态。和服务器的往返交互已经不是必须。路由通过监测路由位置的变化，就会从路由的配置项来匹配新的URL需要显示的部分，然后将其渲染。所有的路由都在浏览器端完成。</p> <p><img src="https://img.hecun.site/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA-spa%E8%B7%AF%E7%94%B1-2019824223548.png" alt="单页面导航-spa路由-2019824223548"></p> <h2 id="路由的工作机制"><a href="#路由的工作机制" class="header-anchor">#</a> 路由的工作机制</h2> <p>在单页应用中，客户端的路由都有以下一些特性：</p> <ul><li>通过路由定义的路径来匹配URL模式</li> <li>当匹配成功是允许应用程序执行代码</li> <li>当路由触发时允许执行需要显示的视图</li> <li>允许通过路由路径传入参数</li> <li>允许用户使用浏览器的导航方法进行单页应用进行导航</li></ul> <p>下面介绍下两种路由的导航方式：</p> <h3 id="片段标识符"><a href="#片段标识符" class="header-anchor">#</a> 片段标识符</h3> <p>路由可以利用 <code>location</code> 对象以编程方式访问当前路由，并且可以通过 <code>window</code> 的 <code>onhashchange</code> 对路由的变化进行监听。</p> <p>假设需要跳转到关于的页面，可以利用如下标签：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#/about<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>关于<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对应的地址栏的URL会变成，<code>http://localhost:8080/#/about</code>。</p> <p>在路由变化时，可以在监听到从从更新局部页面的渲染。</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/hashchange_event" target="_blank" rel="noopener noreferrer">hashchange事件查看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="html5-history"><a href="#html5-history" class="header-anchor">#</a> html5 history</h3> <p>在 <code>history</code> 模式中有 <code>pushState</code> 和 <code>replaceState</code> 两个方法：</p> <ul><li><code>pushState()</code>: 添加历史条目</li> <li><code>replaceState()</code>: 替换已有历史条目</li></ul> <p>通过两个方法可以修改浏览器历史记录栈：</p> <div class="language-js extra-class"><pre class="language-js"><code>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'about'</span><span class="token punctuation">)</span>
</code></pre></div><p>之后的路由会变化为：<code>http://localhost:8080/about</code></p> <p>然后在 popstate 事件中对路由变化进行监听，然后更新页面视图。</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event" target="_blank" rel="noopener noreferrer">popstate事件查看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>相比hash模式，更加美观，也是目前看到比较多的路由类型。但同时需要服务器配置，在使用标签或页面刷新时，服务器需要配置重定向到相同的URL。该方式不兼容一些老式的浏览器。</p> <h2 id="实现一个简版的vue-router"><a href="#实现一个简版的vue-router" class="header-anchor">#</a> 实现一个简版的vue-router</h2> <h3 id="先看看怎么使用-vue-router"><a href="#先看看怎么使用-vue-router" class="header-anchor">#</a> 先看看怎么使用  vue-router</h3> <p>在 <code>main.js</code> 中，我们一般可以这样写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 路由队形的组件</span>
<span class="token keyword">const</span> Foo <span class="token operator">=</span> <span class="token punctuation">{</span> template<span class="token punctuation">:</span> <span class="token string">'&lt;div&gt;foo&lt;/div&gt;'</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> Bar <span class="token operator">=</span> <span class="token punctuation">{</span> template<span class="token punctuation">:</span> <span class="token string">'&lt;div&gt;bar&lt;/div&gt;'</span> <span class="token punctuation">}</span>

<span class="token comment">// 路由表</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/foo'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Foo <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/bar'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Bar <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token comment">// 创建 router 实例，然后传入路由表</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">'hash'</span><span class="token punctuation">,</span> <span class="token comment">// 使用hash模式</span>
  routes
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建和挂载根实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><p>然后，在每个组件中，可以通过 <code>$router</code> 获取到 <code>router</code> 实例， 然后他可以调用 <code>push</code> , <code>go</code> 等方法。<br>
在 <code>$route</code> 中，可以查看到当前路由信息，包括 <code>path</code> ， <code>name</code> 等配置。</p> <p>同时，还提供了两个全局组件 <code>router-view</code> 和 <code>router-link</code>:</p> <ul><li><code>router-view</code> 渲染路由匹配到的组件</li> <li><code>router-link</code> 实现导航</li></ul> <h3 id="主要思路"><a href="#主要思路" class="header-anchor">#</a> 主要思路</h3> <p>实现的大致思路如下：</p> <p><img src="https://img.hecun.site/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA-my-router-%E8%AE%BE%E8%AE%A1-2019824235118.png" alt="单页面导航-my-router-设计-2019824235118"></p> <p>具体目录如下：</p> <div class="language- extra-class"><pre class="language-text"><code>│-- History.js    // 存放路由信息
│-- index.js      // 导出并添加install方法
│-- MyRouter.js   // Router实例
└─components   
  │-- RouterLink.js   // router-link 组件
  └─  RouterView.js   // router-view 组件
</code></pre></div><p>首先在 <code>index.js</code> 中， 这里我们给 <code>Router</code> 添加 <code>install</code> 方法，这样就可以使用 <code>Vue.use()</code> 注册插件，另外，注册 <code>RouterView</code>、 <code>RouterLink</code> 两个全局组件。并将其暴露出去:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> RouterView <span class="token keyword">from</span> <span class="token string">'./components/RouterView'</span>
<span class="token keyword">import</span> RouterLink <span class="token keyword">from</span> <span class="token string">'./components/RouterLink'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'./MyRouter'</span>

Router<span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// todo: 为组件添加 $router 和 $route</span>
  <span class="token comment">// 全局注册组件</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'RouterView'</span><span class="token punctuation">,</span> RouterView<span class="token punctuation">)</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'RouterLink'</span><span class="token punctuation">,</span> RouterLink<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Router
</code></pre></div><p>在 <code>Router</code> 里面做的事情也比较简单：</p> <ol><li>保存当前的路由模式，存储路由信息</li> <li>将路由配置表转化为map</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/foo'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Foo <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/bar'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Bar <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>转化为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>routesMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'/foo'</span><span class="token punctuation">:</span> Foo<span class="token punctuation">,</span>
  <span class="token string">'/bar'</span><span class="token punctuation">:</span> Bar<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样可以利用当前路径获取到要显示的组件<br>
3. 存储当前路由<br>
4. 绑定路由监听事件<br>
5. 实现一些 <code>push</code>, <code>go</code>等之类的方法，用于组件控制路由</p> <p>具体的话，可以参考下面的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> History <span class="token keyword">from</span> <span class="token string">'./History'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Router</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// hash模式或history模式</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> options<span class="token punctuation">.</span>mode <span class="token operator">||</span> <span class="token string">'hash'</span>
    <span class="token comment">// 接收路由表</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routes <span class="token operator">=</span> options<span class="token punctuation">.</span>routes <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// 将路由表转化为map</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>routesMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routes<span class="token punctuation">)</span>
    <span class="token comment">// 保存当前路由</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">History</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将路由表转化为map</span>
  <span class="token function">createMap</span> <span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      memo<span class="token punctuation">[</span>current<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">.</span>component
      <span class="token keyword">return</span> memo
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 判断是不是hash路由</span>
  <span class="token function">isHashMode</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'hash'</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 初始化方法，绑定监听事件</span>
  <span class="token function">init</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isHashMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// hash模式</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// history模式</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// hash模式绑定监听事件</span>
  <span class="token function">initHash</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">!</span>location<span class="token punctuation">.</span>hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// history模式绑定监听事件</span>
  <span class="token function">initHistory</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">!</span>location<span class="token punctuation">.</span>pathname <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>pathname <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 前进后退方法</span>
  <span class="token function">go</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 路由跳转</span>
  <span class="token function">push</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isHashMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// history模式</span>
      history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span>current <span class="token operator">=</span> path
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// hash模式</span>
      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> path
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面给组件添加 <code>$router</code> 和 <code>$route</code>:</p> <ul><li><code>$router</code>: 其实就是在根实例中 <code>router</code>, 也就是上面文件中的 <code>Router</code></li> <li><code>$route</code>: 存储当前路由的一些信息， <code>path</code> , <code>name</code> 等</li></ul> <p>在 <code>install</code> 中，我们可以获取到 <code>Vue</code> 实例；</p> <p>在所有组件中，只有根组件有 <code>router</code> 属性, 这样就可以拿到 <code>Router</code> 实例，里面的 <code>history</code> 就存放当前路由信息。<br>
在vue 组件的渲染顺序， <code>根组件-&gt;父组件-&gt;子组件-&gt;孙子组件-&gt; ...</code>。<br>
同时，可以通过 <code>$parent</code> 获取到父组件。在每个组件中 <code>_root</code> 都拿取父组件的 <code>_root</code>。这样就可以在每个组件中拿取到 <code>Router</code> 实例。<br>
这里使用了 vue 中的 <code>Vue.util.defineReactive</code> 会数据进行了响应式绑定。这样在后面数据更新时，页面就可以变化。<br>
具体可以查看相关文档<a href="https://github.com/vuejs/vue/blob/dev/src/core/observer/index.js#L135" target="_blank" rel="noopener noreferrer">defineReactive方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code>Router<span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">beforeCreate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 根实例</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_root <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router
        Vue<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'$history'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span>history<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 拿取父组件的_root</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>_root
      <span class="token punctuation">}</span>

      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'$router'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// router 的实例</span>
        <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_root<span class="token punctuation">.</span>_router
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'$route'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// current 为当前路由信息</span>
        <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            current<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_root<span class="token punctuation">.</span>$history<span class="token punctuation">.</span>current
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 全局注册组件</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'RouterView'</span><span class="token punctuation">,</span> RouterView<span class="token punctuation">)</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'RouterLink'</span><span class="token punctuation">,</span> RouterLink<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面就完成两个全局组件：<br>
这里需要用到 <a href="https://cn.vuejs.org/v2/guide/render-function.html" target="_blank" rel="noopener noreferrer">渲染函数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>RouterView</code>: 作用就是根据当前path渲染对应的组件。<br>
对应代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'RouterView'</span><span class="token punctuation">,</span>
  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前路由</span>
    <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_root<span class="token punctuation">.</span>_router<span class="token punctuation">.</span>history<span class="token punctuation">.</span>current
    <span class="token comment">// 路由map对象</span>
    <span class="token keyword">let</span> routesMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_root<span class="token punctuation">.</span>_router<span class="token punctuation">.</span>routesMap
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token function">h</span><span class="token punctuation">(</span>routesMap<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>RouterLink</code>: 作用就是对路由进行导航，类似于a标签。<br>
一般会用到两个参数：</p> <ul><li>to：必填 需要跳转的path</li> <li>tag: 非必填 指定要渲染的标签类型 默认为 a<br>
对应代码如下：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'RouterLink'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    tag<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'a'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    to<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
      required<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleClick</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'a'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'hash'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span>attrs <span class="token operator">=</span> <span class="token punctuation">{</span>
        href<span class="token punctuation">:</span> <span class="token string">'#'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span>on <span class="token operator">=</span> <span class="token punctuation">{</span>
        click<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tag<span class="token punctuation">,</span>
      obj<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="最后成果"><a href="#最后成果" class="header-anchor">#</a> 最后成果</h3> <p>最后预览下效果：</p> <p><img src="https://img.hecun.site/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA-vue-router1-201982512453.gif" alt="单页面导航-vue-router1-201982512453"></p> <p>上面只是简单的实现了一下，在 <code>vue-router</code> 中还有很多复杂的用法。大家可以参考官方文档...</p> <p>参考文章：</p> <ol><li>《SPA设计与架构》中单页面导航部分</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/history" target="_blank" rel="noopener noreferrer">MDN-history相关<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HashChangeEvent" target="_blank" rel="noopener noreferrer">MDN-HashChangeEvent相关<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://router.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">vue-router<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <h2 id="写在最后"><a href="#写在最后" class="header-anchor">#</a> 写在最后</h2> <p>能看到这儿的都是人才，感谢！！！<br>
欢迎大家批评指正！！！另外，能否点个赞，评个论！！！<br>
最后附上github连接<a href="https://github.com/hecun0000/vue-router-demo" target="_blank" rel="noopener noreferrer">点击查看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, 顺便求个Star</p> <p><strong>生活不易，大家加油</strong></p> <p><img src="https://img.hecun.site/%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA-0d467baea30117141526801fee1cc56beaa0d9f7-201982581728.gif" alt="单页面导航-0d467baea30117141526801fee1cc56beaa0d9f7-201982581728"></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/25/2019, 3:47:36 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c2692aa7.js" defer></script><script src="/assets/js/7.ee9b7330.js" defer></script><script src="/assets/js/2.55ffe7b1.js" defer></script><script src="/assets/js/58.4c8ae67e.js" defer></script>
  </body>
</html>
