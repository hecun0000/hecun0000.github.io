<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PWA | hecun&#39;s blog</title>
    <meta name="description" content="进击的程序源-hecun">
    <link rel="icon" type="image/x-icon" href="/img/logo.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/img/logo.ico">
  <link rel="stylesheet" type="text/css" href="/css/main.css">
  <mate name="keywords" content="进击的程序源,hecun,禾寸"></mate>
    
    <link rel="preload" href="/assets/css/0.styles.ccc4724e.css" as="style"><link rel="preload" href="/assets/js/app.c2692aa7.js" as="script"><link rel="preload" href="/assets/js/7.ee9b7330.js" as="script"><link rel="preload" href="/assets/js/2.55ffe7b1.js" as="script"><link rel="preload" href="/assets/js/20.f9680dc5.js" as="script"><link rel="prefetch" href="/assets/js/1.6d24a22a.js"><link rel="prefetch" href="/assets/js/10.b80e02fd.js"><link rel="prefetch" href="/assets/js/11.22b74af9.js"><link rel="prefetch" href="/assets/js/12.474b79db.js"><link rel="prefetch" href="/assets/js/13.23a8ba9e.js"><link rel="prefetch" href="/assets/js/14.8437854b.js"><link rel="prefetch" href="/assets/js/15.eb2c7e6a.js"><link rel="prefetch" href="/assets/js/16.14cc9f96.js"><link rel="prefetch" href="/assets/js/17.178deaf5.js"><link rel="prefetch" href="/assets/js/18.b922d114.js"><link rel="prefetch" href="/assets/js/19.6967fed4.js"><link rel="prefetch" href="/assets/js/21.c28a6930.js"><link rel="prefetch" href="/assets/js/22.973aab73.js"><link rel="prefetch" href="/assets/js/23.cb215d9f.js"><link rel="prefetch" href="/assets/js/24.b3c058a2.js"><link rel="prefetch" href="/assets/js/25.34e23410.js"><link rel="prefetch" href="/assets/js/26.ab9e6475.js"><link rel="prefetch" href="/assets/js/27.64be3436.js"><link rel="prefetch" href="/assets/js/28.d2524c5b.js"><link rel="prefetch" href="/assets/js/29.04fa85aa.js"><link rel="prefetch" href="/assets/js/3.53c1b047.js"><link rel="prefetch" href="/assets/js/30.5bccadb5.js"><link rel="prefetch" href="/assets/js/31.0a4f2335.js"><link rel="prefetch" href="/assets/js/32.4568bb0b.js"><link rel="prefetch" href="/assets/js/33.f1ee24e2.js"><link rel="prefetch" href="/assets/js/34.6ead242e.js"><link rel="prefetch" href="/assets/js/35.27efa193.js"><link rel="prefetch" href="/assets/js/36.362e5f5c.js"><link rel="prefetch" href="/assets/js/37.0e4794b1.js"><link rel="prefetch" href="/assets/js/38.9fc75844.js"><link rel="prefetch" href="/assets/js/39.894a1b86.js"><link rel="prefetch" href="/assets/js/40.e2708e69.js"><link rel="prefetch" href="/assets/js/41.a3603a43.js"><link rel="prefetch" href="/assets/js/42.cf7dc3ee.js"><link rel="prefetch" href="/assets/js/43.363d291a.js"><link rel="prefetch" href="/assets/js/44.8d29c24e.js"><link rel="prefetch" href="/assets/js/45.2db43ddc.js"><link rel="prefetch" href="/assets/js/46.0fba0e84.js"><link rel="prefetch" href="/assets/js/47.10f4922e.js"><link rel="prefetch" href="/assets/js/48.56fcc68c.js"><link rel="prefetch" href="/assets/js/49.11209a48.js"><link rel="prefetch" href="/assets/js/5.75ce7176.js"><link rel="prefetch" href="/assets/js/50.98492dc0.js"><link rel="prefetch" href="/assets/js/51.879e5063.js"><link rel="prefetch" href="/assets/js/52.69cb96eb.js"><link rel="prefetch" href="/assets/js/53.a0d23912.js"><link rel="prefetch" href="/assets/js/54.e84d6748.js"><link rel="prefetch" href="/assets/js/55.6a87de8d.js"><link rel="prefetch" href="/assets/js/56.0e16ce35.js"><link rel="prefetch" href="/assets/js/57.89321769.js"><link rel="prefetch" href="/assets/js/58.4c8ae67e.js"><link rel="prefetch" href="/assets/js/59.345b425f.js"><link rel="prefetch" href="/assets/js/6.f8e51914.js"><link rel="prefetch" href="/assets/js/60.350e74f0.js"><link rel="prefetch" href="/assets/js/61.740d651d.js"><link rel="prefetch" href="/assets/js/62.ba2263d7.js"><link rel="prefetch" href="/assets/js/63.b248662e.js"><link rel="prefetch" href="/assets/js/64.bf046848.js"><link rel="prefetch" href="/assets/js/65.dbff5786.js"><link rel="prefetch" href="/assets/js/66.bf57fc70.js"><link rel="prefetch" href="/assets/js/67.42d8239d.js"><link rel="prefetch" href="/assets/js/68.fc59e5ca.js"><link rel="prefetch" href="/assets/js/69.08badfb0.js"><link rel="prefetch" href="/assets/js/70.5e3539ab.js"><link rel="prefetch" href="/assets/js/71.fc913d54.js"><link rel="prefetch" href="/assets/js/72.9406c0cf.js"><link rel="prefetch" href="/assets/js/73.b3485dd2.js"><link rel="prefetch" href="/assets/js/74.f699d6d0.js"><link rel="prefetch" href="/assets/js/75.3b6cf9de.js"><link rel="prefetch" href="/assets/js/76.dae9c229.js"><link rel="prefetch" href="/assets/js/77.a8ab0c06.js"><link rel="prefetch" href="/assets/js/78.6d217328.js"><link rel="prefetch" href="/assets/js/79.4d5870b3.js"><link rel="prefetch" href="/assets/js/8.096c476a.js"><link rel="prefetch" href="/assets/js/80.9fd35370.js"><link rel="prefetch" href="/assets/js/81.ac815421.js"><link rel="prefetch" href="/assets/js/82.918ca1dd.js"><link rel="prefetch" href="/assets/js/83.a6957825.js"><link rel="prefetch" href="/assets/js/84.34be1d45.js"><link rel="prefetch" href="/assets/js/85.f591015b.js"><link rel="prefetch" href="/assets/js/86.4b4fbaad.js"><link rel="prefetch" href="/assets/js/87.24552fe7.js"><link rel="prefetch" href="/assets/js/88.1fe39b72.js"><link rel="prefetch" href="/assets/js/89.b6257e02.js"><link rel="prefetch" href="/assets/js/9.89b67f33.js"><link rel="prefetch" href="/assets/js/90.14b158b9.js"><link rel="prefetch" href="/assets/js/91.00cf1ef4.js"><link rel="prefetch" href="/assets/js/92.44b6910d.js"><link rel="prefetch" href="/assets/js/93.2b920839.js"><link rel="prefetch" href="/assets/js/94.e03699fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccc4724e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">hecun's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/vue/" class="nav-link">VUE</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/think/" class="nav-link">随想</a></div><div class="nav-item"><a href="https://github.com/hecun0000" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/vue/" class="nav-link">VUE</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/think/" class="nav-link">随想</a></div><div class="nav-item"><a href="https://github.com/hecun0000" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>PWA</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/PWA.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/js/PWA.html#_1-什么是pwa" class="sidebar-link">1. 什么是PWA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/PWA.html#_1-1-pwa-的特点" class="sidebar-link">1.1 PWA 的特点</a></li><li class="sidebar-sub-header"><a href="/js/PWA.html#_1-2-pwa-的特性" class="sidebar-link">1.2 PWA 的特性</a></li></ul></li><li><a href="/js/PWA.html#_2-pwa的核心技术" class="sidebar-link">2. PWA的核心技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/PWA.html#_2-1-web-app-manifest" class="sidebar-link">2.1 Web App Manifest</a></li><li class="sidebar-sub-header"><a href="/js/PWA.html#_2-2-service-worker" class="sidebar-link">2.2 Service Worker</a></li><li class="sidebar-sub-header"><a href="/js/PWA.html#_2-3-离线通知" class="sidebar-link">2.3 离线通知</a></li><li class="sidebar-sub-header"><a href="/js/PWA.html#_2-4-app-shell-和骨架屏" class="sidebar-link">2.4 App Shell 和骨架屏</a></li></ul></li><li><a href="/js/PWA.html#_3-pwa在行业中的优秀实践" class="sidebar-link">3. PWA在行业中的优秀实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/PWA.html#_3-1-pwa-在爱奇艺登录的应用" class="sidebar-link">3.1 PWA 在爱奇艺登录的应用</a></li><li class="sidebar-sub-header"><a href="/js/PWA.html#_3-2-饿了么多页应用在pwa上面的实践" class="sidebar-link">3.2 饿了么多页应用在PWA上面的实践</a></li></ul></li><li><a href="/js/PWA.html#_4-项目中应用" class="sidebar-link">4. 项目中应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/PWA.html#_4-1-pwa实践方式" class="sidebar-link">4.1 PWA实践方式</a></li></ul></li><li><a href="/js/PWA.html#参考文章" class="sidebar-link">参考文章</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pwa"><a href="#pwa" class="header-anchor">#</a> PWA</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p><code>PWA</code> （ <code>Progressive Web Apps</code> ），即为渐进式网络应用。突破了以往 <code>web</code> 应用只能依赖于互联网分发与依赖浏览器的两种方式。瞬间打开了 <code>web</code> 应用从性能、架构到用户体验的一系列可能性。同时，<code>PWA</code> 技术属于 <code>web</code> 标准。因此也具备了一套代码发布可以同时跨桌面端设备、跨操作系统、跨浏览器的超级应用。同时，在国内也有微博，饿了么使用 <code>PWA</code> 技术发布专门的 <code>PWA</code> 产品。</p> <h2 id="_1-什么是pwa"><a href="#_1-什么是pwa" class="header-anchor">#</a> 1. 什么是PWA</h2> <p><code>PWA</code> 它不是特指某一项技术，而是应用多项技术来改善用户体验的 <code>Web App</code>，其核心技术包括 <code>Web App Manifest</code>，<code>Service Worker</code>，<code>Web Push</code> 等（在后续进行简单说明），<strong>用户体验</strong>才是 <code>PWA</code> 的核心。</p> <h3 id="_1-1-pwa-的特点"><a href="#_1-1-pwa-的特点" class="header-anchor">#</a> 1.1 PWA 的特点</h3> <p><code>PWA</code> 主要特点如下：</p> <ul><li><strong>可靠</strong> - 即使在网络不稳定甚至断网的环境下，也能瞬间加载并展现</li> <li><strong>用户体验</strong> - 快速响应，具有平滑的过渡动画及用户操作的反馈</li> <li><strong>用户黏性</strong> - 和 <code>Native App</code> 一样，可以被添加到桌面，能接受离线通知，具有沉浸式的用户体验</li></ul> <h3 id="_1-2-pwa-的特性"><a href="#_1-2-pwa-的特性" class="header-anchor">#</a> 1.2 PWA 的特性</h3> <p><code>PWA</code> 本质上还是 <code>Web App</code>，借助了新技术具备了一些 <code>Native App</code> 的特性，所以它兼具 <code>Web App</code> 和 <code>Native App</code>的优点，同时在安全、体验和用户黏性三个方面都有很大的提升。总结下来，<code>PWA</code> 具有如下特性。</p> <ul><li><p><strong>渐进式</strong> - 适用于所有浏览器，因为它是以渐进式增强作为宗旨开发的。在不支持的相关浏览器中可以传统 <code>web</code> 网页支持</p></li> <li><p><strong>连接无关性</strong> - 能够借助 <code>Service Worker</code> 在离线或者网络较差的情况下正常访问</p></li> <li><p><strong>类原生应用</strong> - 由于是在 <code>App Shell</code> 模型基础上开发，因此应具有 <code>Native App</code> 的交互，给用户 <code>Native App</code> 的体验</p></li> <li><p><strong>持续更新</strong> - 始终是最新的，无版本和更新问题</p></li> <li><p><strong>安全</strong> - 通过 <code>HTTPS</code> 协议提供服务，防止窥探，确保内容不被篡改</p></li> <li><p><strong>可索引</strong> - <code>manifest</code> 文件和 <code>Service Worker</code> 可以让搜索引擎索引到，从而将其识别为『应用』</p></li> <li><p><strong>黏性</strong> - 通过推送离线通知等，可以让用户回流</p></li> <li><p><strong>可安装</strong> - 用户可以添加常用的 <code>Web App</code> 到桌面，免去到应用商店下载的麻烦</p></li> <li><p><strong>可链接</strong> - 通过链接即可分享内容，无需下载安装</p></li></ul> <p>下表列出了传统 <code>Web App</code>，<code>Native App</code> 和 <code>PWA</code> 在各特性的对比。</p> <table><thead><tr><th></th> <th>是否可安装</th> <th>是否可链接访问</th> <th>用户体验</th> <th>用户黏性</th></tr></thead> <tbody><tr><td>传统 Web</td> <td>无法安装</td> <td>可链接访问</td> <td>体验一般</td> <td>黏性差</td></tr> <tr><td>Native App</td> <td>可安装</td> <td>不可链接访问</td> <td>体验好</td> <td>黏性强</td></tr> <tr><td>PWA</td> <td>可安装</td> <td>可链接访问</td> <td>体验好</td> <td>黏性强</td></tr></tbody></table> <h2 id="_2-pwa的核心技术"><a href="#_2-pwa的核心技术" class="header-anchor">#</a> 2. PWA的核心技术</h2> <p><code>PWA</code> 的核心是用户体验。能让 PWA 达到原生应用的体验并不仅仅依赖于某一项技术，而是多管齐下，进行改进，从而在安全、性能和体验上都获得很大的提升。下面介绍下其中最为核心的相关技术，分别是 <code>Web App Manifest</code> 、<code>Service Worker</code> 、离线通知、<code>App Shell</code> 和骨架屏。</p> <p><img src="http://static.hecun.site/hecun15792334717400.png" alt="pwa实现"></p> <h3 id="_2-1-web-app-manifest"><a href="#_2-1-web-app-manifest" class="header-anchor">#</a> 2.1 Web App Manifest</h3> <p><code>web</code> 应用清单文件是简单JSON文件，<code>manifest.json</code>。开发者可以在这个 <code>JSON</code> 文件中配置 <code>PWA</code> 的相关信息，应用名称、图标、启动方式、背景颜色、主题颜色等等。添加到桌面后，<code>PWA</code> 并不是一个快捷方式，而是能够在系统中作为一个独立的 <code>App</code> 存在的，用户可以设置它的权限，清除它的缓存，就和 <code>Native App</code> 一样。</p> <p><img src="http://static.hecun.site/hecun157916464145796.png" alt="微信截图_20200116165028.png"></p> <p>添加主屏的好处是显而易见的，主要有以下两方面的优点：</p> <ul><li>缩短了用户和站点的距离，用户可以在主屏直达站点</li> <li>是能够让网站具有更加接近 <code>Native App</code> 的体验，具有启动画面、沉浸式浏览体验</li></ul> <p>下图就是 <code>pwa</code> 应用添加到桌面的步骤以及启动的效果：</p> <div class="display-imgs"><img src="http://static.hecun.site/hecun157933309742762.jpg"> <img src="http://static.hecun.site/hecun15793331211827.jpg"> <img src="http://static.hecun.site/hecun157933348313625.gif"></div> <h3 id="_2-2-service-worker"><a href="#_2-2-service-worker" class="header-anchor">#</a> 2.2 Service Worker</h3> <p><code>Service Worker</code> 在 <code>PWA</code> 中最重要的功能就是<strong>离线与缓存</strong>。</p> <p>它是浏览器在后端独立于网页主进程运行的脚本，它可以拦截网络请求，可以操作本地缓存，还可以接受服务器推送的离线消息，它的功能很丰富，并且 <code>Service Worker</code> 可扩展性很强，想象空间比较大，未来 PWA 很多的特性会基于 <code>Service Worker</code> 来设计，这也是笔者为什么说它是 <code>PWA</code> 的心脏。</p> <p><img src="http://static.hecun.site/hecun157916013568782.png" alt="server_browser_service_worker.png"></p> <p>简单归纳一下，<code>Service Worker</code> 的特点，如下：</p> <ul><li>一个特殊的 <code>worker</code> 线程，独立于当前网页主线程，有自己的执行上下文</li> <li>一旦被安装，就永远存在，除非显示取消注册</li> <li>使用到的时候浏览器会自动唤醒，不用的时候自动休眠</li> <li>可拦截并代理请求和处理返回，可以操作本地缓存，如 <code>CacheStorage</code>，<code>IndexedDB</code> 等</li> <li>离线内容开发者可控</li> <li>能接受服务器推送的离线消息</li> <li>异步实现，内部接口异步化基本是通过 <code>Promise</code> 实现</li> <li>不能直接操作 <code>DOM</code></li> <li>必须在 <code>HTTPS</code> 环境下才能工作</li></ul> <p>截止目前，在浏览器的兼容性上面也有着不错的表现。现如今已有高达92.45%的浏览器已经支持。在不支持的浏览器，可以以传统网页进行访问，不影响其功能。
<img src="http://static.hecun.site/hecun157916628448781.png" alt="微信截图_20200116171752.png"></p> <h3 id="_2-3-离线通知"><a href="#_2-3-离线通知" class="header-anchor">#</a> 2.3 离线通知</h3> <p>在有了 <code>Service Worker</code>，其他功能才能发挥更大的作用，离线通知就是其中之一。</p> <p>离线通知是指在用户  没有打开 <code>PWA</code> 站点的情况下，也能接受到服务器推送过来的通知并展现给用户，其中包括了两部分，离线推送和展现通知，分别是 <code>Web Push</code> 和 <code>Notification API</code>。</p> <p>推送通知是一种时效性非常强的与用户沟通的方式，即使在 <code>PWA</code> 没有打开的情况下，依然可以触达用户，能够立即引起用户的注意，对于一些突发事件、限时活动、重大升级等时效性要求很高的场景，推送通知总是最好的选择，这也是过去 <code>Native App</code> 强于 <code>Web App</code> 的原因之一。因此 <code>PWA</code> 提供了 <code>Web Push</code> 和 <code>Notification API</code> 补全了这一功能。</p> <p><img src="http://static.hecun.site/hecun157924163333442.png" alt="微信截图_20200117123013.png"></p> <p>在浏览器兼容方面，已经在绝大部分浏览器上所支持。但在 <code>chorme49</code> 上面部分支持（不支持 <code>PushEvent.data</code> 和 <code>PushMessageData</code> ）。</p> <p>标准Web Push的流程：</p> <ul><li>页面向 <code>Web</code> 引擎注册 <code>SW</code> 。</li> <li>页面向 <code>Web</code> 引擎订阅消息， <code>Web</code> 引擎向 <code>Push</code> 服务器（GCM/FCM）订阅消息， <code>Push</code> 服务器返回订阅结果（<code>Push Subscription</code>，服务器地址）。页面将订阅结果（<code>Push Subscription</code>）发送给页面服务器。</li> <li>页面服务器向Push服务器推送消息，Push服务器向Web引擎推送消息，<code>Web</code> 引擎唤醒 <code>SW</code>，触发 <code>SW</code> 的 <code>onpush</code>，页面处理 <code>onpush</code> 消息。</li></ul> <p><img src="http://static.hecun.site/hecun157925070740611.jpg" alt="v2-3ca04e53ba386ab84074cc0291f0680f.jpg"></p> <p><code>Web Push</code>应用起来并不容易，主要是 <code>push service</code> 需要浏览器自身去实现。而在谷歌的 <code>Push Service（GCM/FCM）</code>在国内是不可用的。</p> <p>同时，在开始发送用户通知前，需要通过提示的方式获取他们的授权。如果用户拒绝，则无法发生任何消息，并且不会再给他们提示。</p> <h3 id="_2-4-app-shell-和骨架屏"><a href="#_2-4-app-shell-和骨架屏" class="header-anchor">#</a> 2.4 App Shell 和骨架屏</h3> <p><code>App Shell</code> 和骨架屏在提升首屏体验上发挥了重要作用。</p> <p><code>App Shell</code> 是 <code>PWA</code> 界面展示所需的最小资源集合，即让页面能够正常运行起来的最小的 <code>HTML</code>、<code>CSS</code> 和 <code>JavaScript</code> 等静态资源集，每个页面都需要加载这一部分资源。利用 <code>Service Worker</code> 把这部分资源缓存在本地，就能够在打开 <code>PWA</code> 时不需要从服务器端获取这部分资源，从而能够瞬间渲染出页面框架，不仅提升了首屏的速度，还减小了站点流量的消耗。</p> <p>骨架屏（<code>App Skeleton</code>），也是提升首屏体验的有效方式。它的原理是在真实内容渲染完成之前，使用一些能够快速渲染的静态图片/样式/色块/部分真实内容进行占位，让用户对真实内容区域有心理预期。<code>App Shell</code> 和骨架屏都是提升首屏体验的绝好妙招。</p> <p><code>App Shell</code> 和骨架屏相辅相成，<code>App Shell</code> 显示页面的外框部分，初始内容就用骨架屏来填充，保证主体内容区域不会留白，它的特点是：</p> <ul><li>在页面加载初期预先渲染内容，提升感官上的体验</li> <li>一般情况骨架屏和实际内容的结构是类似的，因此之后的切换不会过于突兀。这点和传统的 <code>Loading</code> 动图不同，可以认为是其升级版</li> <li>只需要简单的 <code>CSS</code> 支持 (涉及图片懒加载可能还需要 <code>JS</code> )，不要求 <code>HTTPS</code> 协议，没有额外的学习和维护成本</li> <li>如果页面采用组件化开发，每个组件可以根据自身状态定义自身的骨架屏及其切换时机，同时维持了组件之间的独立性。</li></ul> <p>下图是饿了么web端所展示的效果，为更好的展示效果，我将 <code>network</code> 调整为 <code>slow 3G</code> 的情况。在页面刚进入的过程中，先使用骨架屏进行占位。然后在加载图片时，先使用默认图片进行显示。在真正图片加载好之后，进行图片替换。对用户体验有了很大提升。
<img src="http://static.hecun.site/hecun157924326488460.gif" alt="骨架屏.gif"></p> <h2 id="_3-pwa在行业中的优秀实践"><a href="#_3-pwa在行业中的优秀实践" class="header-anchor">#</a> 3. PWA在行业中的优秀实践</h2> <h3 id="_3-1-pwa-在爱奇艺登录的应用"><a href="#_3-1-pwa-在爱奇艺登录的应用" class="header-anchor">#</a> 3.1 PWA 在爱奇艺登录的应用</h3> <p>在爱奇艺主站的登录页面，是使用 <code>Service Worker</code> 技术来进行网络处理的优化，对常用的 <code>CSS</code>、<code>JS</code> 以及图片资源进行缓存，令登录窗口的展现速度明显提升，详见下图：</p> <p><img src="http://static.hecun.site/hecun157924638456971.png" alt="518e96220c7e8d40b11c7554b0679d04.png"></p> <p>从图中我们可以看出：从 <code>response start</code> 开始的网络响应时间明显降低。更为重要的是，从右侧的“页面加载时间分布”图可以看出，使用 <code>Service Worker</code> 后页面加载时间非常稳定，网络波动对于页面加载造成的影响很小，这对于用户的实际体验会有明显的加分。</p> <h3 id="_3-2-饿了么多页应用在pwa上面的实践"><a href="#_3-2-饿了么多页应用在pwa上面的实践" class="header-anchor">#</a> 3.2 饿了么多页应用在PWA上面的实践</h3> <p>饿了么在首屏加载上使用 App Shell， 配合骨架屏 以及 服务端渲染 （Server Side Rendering）在首屏加载中有了很大提升。如下图所示，200ms内就已经完成首次渲染，渲染出页面基本的 <code>html</code> 页面。</p> <p><img src="http://static.hecun.site/hecun157925337085377.png" alt="微信截图_20200117172906.png"></p> <p>同时， 在 Google 开发者网站上也对 http://ele.me 的案例进行了<a href="https://developers.google.cn/web/showcase/2017/eleme" target="_blank" rel="noopener noreferrer">分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。从这个案例分析中，我们可以看到 <code>ele.me</code> <code>PWA</code> 改造的收益如下：</p> <ul><li>预缓存的页面平均加载时间减少 11.6%</li> <li>所有页面的平均加载时间减少 6.35%</li> <li>在 <code>3G</code> 网络并且是第一次加载时，从页面加载到用户可操作的时间下降到 4.93s</li></ul> <p>可见，<code>http://ele.me</code> 同样取得了很不错的收益。</p> <h2 id="_4-项目中应用"><a href="#_4-项目中应用" class="header-anchor">#</a> 4. 项目中应用</h2> <p>目前基于公司项目来说，公司内 <code>web</code> 端以 <code>vue</code> 为技术栈开发为主。在 <code>vue</code> 的基础上加入 <code>PWA</code> 技术是可行的，并且在用户体验上也会有一定程度的提升。属于锦上添花的功能。原因如下：</p> <ul><li><code>vue</code> 为单页应用框架，契合 <code>pwa</code> 的开发建议</li> <li>在 <code>vue-cli3</code> 脚手架工具中已经支持 <code>pwa</code> 应用</li> <li><code>pwa</code> 为渐进式应用，用户浏览器不支持的情况下会以普通 <code>web</code> 网页进行访问</li></ul> <h3 id="_4-1-pwa实践方式"><a href="#_4-1-pwa实践方式" class="header-anchor">#</a> 4.1 PWA实践方式</h3> <ol><li>添加 Web App Manifest 文件</li></ol> <p>添加 Manifest.json 文件配置基本应用信息。并引导用户添加应用的桌面快捷方式。在 <code>pc</code> 端的效果如下（以 <code>vue</code> 官网为例）：</p> <p><img src="http://static.hecun.site/hecun15793356411371.png" alt="微信截图_20200118162000.png"></p> <ol start="2"><li>使用 <code>Service Worker</code>  对部分静态资源文件进行缓存</li></ol> <p><code>Service Worker</code> 是浏览器在后端独立于网页主进程运行的脚本，它可以拦截网络请求，可以操作本地缓存等。在项目中可以将常用的图片，<code>css</code> 文件，<code>js</code> 文件，请求常量的接口数据等进行缓存。可以减少请求，提高静态资源加载的速度。</p> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <p><a href="https://lavas-project.github.io/pwa-book/" target="_blank" rel="noopener noreferrer">PWA应用实战<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://zhuanlan.zhihu.com/p/31373357" target="_blank" rel="noopener noreferrer">PWA 是否能弥补Web 劣势，带来新一轮大前端技术洗牌？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://zhuanlan.zhihu.com/p/25800461" target="_blank" rel="noopener noreferrer">PWA 在饿了么的实践经验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.infoq.cn/article/oeIGSQADsm483Tv6br7j" target="_blank" rel="noopener noreferrer">PWA 技术解析及爱奇艺 PC 端的实践<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://zhuanlan.zhihu.com/p/50502316" target="_blank" rel="noopener noreferrer">PWA系列 -- 分享PWA在阿里体系内的实践经验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.qingtingip.com/h_246262.html" target="_blank" rel="noopener noreferrer">PWA 推送实践<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/10/2020, 9:56:33 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c2692aa7.js" defer></script><script src="/assets/js/7.ee9b7330.js" defer></script><script src="/assets/js/2.55ffe7b1.js" defer></script><script src="/assets/js/20.f9680dc5.js" defer></script>
  </body>
</html>
